# Data Model & Knowledge Graph Specification (DM-KGS)

**Project:** BPM Prediction Platform  
**Version:** 2.0 (Full Scope)  
**Status:** Approved Architecture Baseline  

–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –≤–∏–∑–Ω–∞—á–∞—î —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö –¥–ª—è –≤—Å—ñ—Ö —Ä—ñ–≤–Ω—ñ–≤ —Å–∏—Å—Ç–µ–º–∏: –≤—ñ–¥ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–Ω–∞–Ω—å (POKG) –¥–æ —Ç–µ–Ω–∑–æ—Ä—ñ–≤ –¥–ª—è –Ω–µ–π—Ä–æ–º–µ—Ä–µ–∂—ñ.

---

## 1. –ö–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è –ê—Ç—Ä–∏–±—É—Ç—ñ–≤

–î–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –≥–Ω—É—á–∫–æ—Å—Ç—ñ —Å–∏—Å—Ç–µ–º–∏ –≤—Å—ñ –∞—Ç—Ä–∏–±—É—Ç–∏ –ø–æ–¥—ñ–ª–µ–Ω–æ –Ω–∞ —Ç—Ä–∏ —Ä—ñ–≤–Ω—ñ. –¶–µ –¥–æ–∑–≤–æ–ª—è—î —Ä–æ–∑–¥—ñ–ª–∏—Ç–∏ "—Ö–∞—Ä–¥–∫–æ–¥" —è–¥—Ä–∞ –≤—ñ–¥ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—É.

| –†—ñ–≤–µ–Ω—å | –û–ø–∏—Å | –ü—Ä–∏–∫–ª–∞–¥–∏ –∑ –∫–æ–¥—É | –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è |
| :--- | :--- | :--- | :--- |
| **üî¥ Fundamental**<br>(System Core) | –ö—Ä–∏—Ç–∏—á–Ω—ñ –ø–æ–ª—è –¥–ª—è –ø–æ–±—É–¥–æ–≤–∏ —Ç–æ–ø–æ–ª–æ–≥—ñ—ó –≥—Ä–∞—Ñ–∞ —Ç–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó. –ñ–æ—Ä—Å—Ç–∫–æ –ø—Ä–æ–ø–∏—Å–∞–Ω—ñ –≤ –ª–æ–≥—ñ—Ü—ñ `GraphBuilder`. | `ACT_ID_`, `PROC_INST_ID_`, `SEQUENCE_COUNTER_`, `PROC_KEY_` | **Hardcoded** |
| **üü° Base**<br>(Standard BPM) | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, –ø—Ä–∏—Ç–∞–º–∞–Ω–Ω—ñ –±—É–¥—å-—è–∫–æ–º—É –ø—Ä–æ—Ü–µ—Å—É. –°–∏—Å—Ç–µ–º–∞ –º–∞—î –≤–±—É–¥–æ–≤–∞–Ω—ñ –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å–æ—Ä–∏ –¥–ª—è –Ω–∏—Ö. | `DURATION_`, `START_TIME_`, `user_compl_login` (Resource) | `data_sources.yaml` |
| **üü¢ Custom**<br>(Business Domain) | –°–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –±—ñ–∑–Ω–µ—Å-–¥–∞–Ω—ñ (–∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è). –û–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ. | `overdue_work`, `duration_work`, `PurchasingBudget`, `CategoryL1` | `features.yaml` |

---

## 2. –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ç–∞ –Ü—î—Ä–∞—Ä—Ö—ñ—è

–°–∏—Å—Ç–µ–º–∞ –ø—ñ–¥—Ç—Ä–∏–º—É—î —Å–∫–ª–∞–¥–Ω—ñ –≤–∫–ª–∞–¥–µ–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏ (Parent $\to$ Child).

### 2.1. –†—ñ–≤–Ω—ñ –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤

| –°—É—Ç–Ω—ñ—Å—Ç—å | ID –≤ –°–∏—Å—Ç–µ–º—ñ | –î–∂–µ—Ä–µ–ª–æ (Camunda) | –û–ø–∏—Å |
| :--- | :--- | :--- | :--- |
| **Document** | `doc_id` | *Business Key / Var* | –ì–ª–æ–±–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–Ω–∞–ø—Ä., –ó–∞—è–≤–∫–∞). –°–ø—ñ–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≤—Å—ñ—Ö –ø—ñ–¥–ø—Ä–æ—Ü–µ—Å—ñ–≤. |
| **Root Process** | `root_proc_id` | `ROOT_PROC_INST_ID_` | –ì–æ–ª–æ–≤–Ω–∏–π –µ–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–æ—Ü–µ—Å—É. |
| **Scope (Trace)** | `proc_inst_id` | `PROC_INST_ID_` | ID –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è (–º–æ–∂–µ –±—É—Ç–∏ CallActivity). |
| **Flow Node** | `node_instance_id` | `ID_` (Act Inst ID) | –£–Ω—ñ–∫–∞–ª—å–Ω–∞ –ø–æ–¥—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è. |
| **BPMN Template** | **`bpmn_id`** | `ACT_ID_` | –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≤—É–∑–æ–ª —É POKG (Task Definition Key). |

---

## 3. POKG: –°—Ö–µ–º–∞ –ë–∞–∑–∏ –ó–Ω–∞–Ω—å (Neo4j)

–ì—Ä–∞—Ñ, —â–æ –∑–±–µ—Ä—ñ–≥–∞—î "—Å—Ç–∞—Ç–∏–∫—É" (—Å—Ç—Ä—É–∫—Ç—É—Ä—É) —Ç–∞ "—ñ—Å—Ç–æ—Ä—ñ—é" (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É).

### 3.1. –í—É–∑–ª–∏ (Nodes)

| Label | –û—Å–Ω–æ–≤–Ω—ñ –í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ | –û–ø–∏—Å |
| :--- | :--- | :--- |
| **`:ProcessDef`** | `process_key`, `version_tag`, `name` | –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—É (–Ω–∞–ø—Ä., "Tender_v1"). |
| **`:Task`** | `bpmn_id`, `name`, `type`, `lane` | –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ (`UserTask`, `ServiceTask`, `CallActivity`). |
| **`:Gateway`** | `bpmn_id`, `gateway_type`, `direction` | –õ–æ–≥—ñ—á–Ω—ñ —Ä–æ–∑–≥–∞–ª—É–∂–µ–Ω–Ω—è (`XOR`, `AND`). |
| **`:Event`** | `bpmn_id`, `event_type` | –ü–æ–¥—ñ—ó (`Start`, `End`, `Timer`). |
| **`:Role`** | `role_code` | –ü–æ—Å–∞–¥–∞ (`user_compl_position`). |
| **`:Resource`** | `user_login` | –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –≤–∏–∫–æ–Ω–∞–≤–µ—Ü—å (–æ–ø—Ü—ñ–π–Ω–æ, –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É). |

> **–í–∞–∂–ª–∏–≤–æ –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó:** –ü—Ä–∏ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—ñ `edge_attr` –¥–ª—è `Fusion Graph` –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ –æ–∑–Ω–∞–∫–∏, —â–æ –º—ñ—Å—Ç—è—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –º–∞–π–±—É—Ç–Ω—î (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "—Å–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤—Å—å–æ–≥–æ –∫–µ–π—Å—É"). –î–æ–∑–≤–æ–ª—è—é—Ç—å—Å—è –ª–∏—à–µ:
> 1. –¢–æ–ø–æ–ª–æ–≥—ñ—á–Ω—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –∑ BPMN.
> 2. –Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ –¥–∞–Ω—ñ, –¥–æ—Å—Ç—É–ø–Ω—ñ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ–¥—ñ—ó $t$ (Cumulative Features).
> 3. 
### 3.2. –ó–≤'—è–∑–∫–∏ (Relationships)

* **`(:Task)-[:FLOWS_TO]->(:Task)`**
    * *Stat Attributes:* `transition_prob` (—á–∞—Å—Ç–æ—Ç–∞ –ø–µ—Ä–µ—Ö–æ–¥—É), `avg_duration_sec`.
* **`(:Task {type:'CallActivity'})-[:CALLS]->(:ProcessDef)`**
    * *Purpose:* –ú–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è –ø–µ—Ä–µ—Ö–æ–¥—É –≤ –ø—ñ–¥–ø—Ä–æ—Ü–µ—Å (Hierarchy).
* **`(:Task)-[:PERFORMED_BY]->(:Role)`**
    * *Stat Attributes:* `execution_count`.

---

## 4. Instance Graph & Global Context (Dynamic Data)

–¶–µ –¥–∞–Ω—ñ, —â–æ –Ω–∞–¥—Ö–æ–¥—è—Ç—å –Ω–∞ –≤—Ö—ñ–¥ `Inference Controller`.

### 4.1. –ì–ª–æ–±–∞–ª—å–Ω–∏–π –ö–æ–Ω—Ç–µ–∫—Å—Ç –î–æ–∫—É–º–µ–Ω—Ç–∞ (Global Features)
–¶—ñ –∞—Ç—Ä–∏–±—É—Ç–∏ —î –Ω–µ–∑–º—ñ–Ω–Ω–∏–º–∏ (–∞–±–æ –ø–æ–≤—ñ–ª—å–Ω–æ –∑–º—ñ–Ω–Ω–∏–º–∏) –¥–ª—è –≤—Å—å–æ–≥–æ –≥—Ä–∞—Ñ–∞. –í–æ–Ω–∏ –∑–∞–¥–∞—é—Ç—å "—É–º–æ–≤–∏ –≥—Ä–∏".

| –ê—Ç—Ä–∏–±—É—Ç (Internal) | –î–∂–µ—Ä–µ–ª–æ (Camunda Vars) | –¢–∏–ø | –û–±—Ä–æ–±–∫–∞ |
| :--- | :--- | :--- | :--- |
| `budget_amount` | `PurchasingBudget` | Float | LogNorm |
| `price_final` | `FinalPrice` | Float | LogNorm |
| `category_l1` | `CategoryL1` | Cat | Embedding |
| `supplier_class` | `ClassSSD` | Cat | Embedding |
| `company_id` | `Company_SO` | Cat | Embedding |

### 4.2. –ê—Ç—Ä–∏–±—É—Ç–∏ –í—É–∑–ª—ñ–≤ (Node Features)
–î–∞–Ω—ñ –∑ —Ç–∞–±–ª–∏—Ü—ñ —ñ—Å—Ç–æ—Ä—ñ—ó (`ACT_HI_ACTINST` + `bpm_tasks`).

| –ê—Ç—Ä–∏–±—É—Ç | –î–∂–µ—Ä–µ–ª–æ | –¢–∏–ø | –û–ø–∏—Å |
| :--- | :--- | :--- | :--- |
| `duration_total` | `DURATION_` | Float | –ü–æ–≤–Ω–∏–π —á–∞—Å –∂–∏—Ç—Ç—è —Ç–æ–∫–µ–Ω–∞. |
| `duration_work` | `duration_work` | Float | –ß–∏—Å—Ç–∏–π —á–∞—Å —Ä–æ–±–æ—Ç–∏ –≤–∏–∫–æ–Ω–∞–≤—Ü—è. |
| `wait_time` | *Calc (`first_view` - `START`)* | Float | –ß–∞—Å –ø—Ä–æ—Å—Ç–æ—é –≤ —á–µ—Ä–∑—ñ. |
| `is_overdue` | `overdue_work` | Bool | –ß–∏ –ø–æ—Ä—É—à–µ–Ω–æ SLA (–∑ `global_statistics`). |
| `action_result` | `taskaction_code` | Cat | –ö–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É (Approve/Reject). |
| `task_status` | `task_status` | Cat | –¢–µ—Ö–Ω—ñ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å (Completed/Deleted). |
| `executor_role` | `user_compl_position` | Cat | –†–æ–ª—å –∑ POKG (—á–µ—Ä–µ–∑ Fusion). |
| `concurrency` | `active_executions` | Int | –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤ —É –º–æ–º–µ–Ω—Ç –≤–∏–∫–æ–Ω–∞–Ω–Ω—è. |

---

## 5. Feature Engineering (Tensor Specification)

–û–ø–∏—Å —Ç–æ–≥–æ, —è–∫ –∞—Ç—Ä–∏–±—É—Ç–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –Ω–∞ —Ç–µ–Ω–∑–æ—Ä–∏ –¥–ª—è –º–æ–¥–µ–ª—ñ.

### 5.1. Time Encoding Strategy
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≥—ñ–±—Ä–∏–¥–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–ª—è –∫–æ–¥—É–≤–∞–Ω–Ω—è —á–∞—Å—É.

1.  **Relative Dynamics (Dynamic):**
    * –í—Ö—ñ–¥: `timestamps` (Unix time).
    * –õ–æ–≥—ñ–∫–∞ (–≤ `forward`): `delta_t = current_max_time - node_time`.
    * –ï–Ω–∫–æ–¥–∏–Ω–≥: **Time2Vec** (–≤–∏–≤—á–∞—î –ø–∞—Ç–µ—Ä–Ω–∏ "–Ω–µ–¥–∞–≤–Ω—ñ—Ö" –ø–æ–¥—ñ–π).
2.  **Calendar Context (Static):**
    * –í–∏—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –∑ `START_TIME_` –ø—ñ–¥ —á–∞—Å –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å–∏–Ω–≥—É.
    * –§—ñ—á—ñ: `Month` (Emb), `DayOfWeek` (Emb), `IsWeekend` (Bool), `IsBusinessHour` (Bool), `Quarter` (Emb).

### 5.2. Node Vector ($x$) Construction
–í–µ–∫—Ç–æ—Ä –∫–æ–∂–Ω–æ–≥–æ –≤—É–∑–ª–∞ —Ñ–æ—Ä–º—É—î—Ç—å—Å—è –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü—ñ—î—é:

```python
x_node = Concat(
    # --- 1. Dynamic Business Metrics (IG) ---
    LogNorm(duration_work),      # –ß–∏—Å—Ç–∞ —Ä–æ–±–æ—Ç–∞
    LogNorm(wait_time),          # –û—á—ñ–∫—É–≤–∞–Ω–Ω—è
    StandardScaler(overdue_val), # –ù–∞—Å–∫—ñ–ª—å–∫–∏ –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–æ
    Identity(is_overdue_flag),   # –§–∞–∫—Ç –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–Ω—è
    Identity(active_execs),      # –ü–∞—Ä–∞–ª–µ–ª—ñ–∑–º

    # --- 2. Categorical Embeddings (IG + Fusion) ---
    Embedding(action_result),    # –©–æ –≤–∏—Ä—ñ—à–∏–ª–∏?
    Embedding(task_status),      # –Ø–∫ –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å?
    Embedding(executor_role),    # –•—Ç–æ —Ä–æ–±–∏–≤?

    # --- 3. Structural Context (POKG) ---
    Node2Vec(bpmn_id),           # –î–µ —Ü–µ –≤ —Å—Ö–µ–º—ñ?
    OneHot(node_type),           # Task vs Gateway

    # --- 4. Calendar Context ---
    Embedding(month), Embedding(weekday), ...
)
````

### 5.3. Global Vector ($u$)

–í–µ–∫—Ç–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞, —è–∫–∏–π –≤–ø–ª–∏–≤–∞—î –Ω–∞ –≤–µ—Å—å –≥—Ä–∞—Ñ (—á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω—ñ–∑–º Attention –∞–±–æ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü—ñ—é –ø—ñ—Å–ª—è –ø—É–ª—ñ–Ω–≥—É).

```python
u_global = Concat(
    LogNorm(budget), 
    LogNorm(price), 
    Embedding(category), 
    Embedding(supplier)
)
```

-----

## 6\. Tensor Interface (PyTorch Geometric)

–§—ñ–Ω–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–∞–Ω–∏—Ö, —â–æ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è —É –º–µ—Ç–æ–¥ `model.forward(data)`.

1.  **`x` (Node Features):**

      * Shape: `[num_nodes, node_dim]`
      * Type: `torch.float32`

2.  **`edge_index` (Adjacency):**

      * Shape: `[2, num_edges]`
      * Type: `torch.long` (COO Format)

3.  **`edge_attr` (Edge Features):**

      * Shape: `[num_edges, edge_dim]`
      * Content: `[LogNorm(duration_transition), POKG_Probability]`

4.  **`doc_features` (Global Context):**

      * Shape: `[batch_size, global_dim]`
      * *–ü—Ä–∏–º—ñ—Ç–∫–∞:* –¶–µ –æ–∫—Ä–µ–º–∏–π —Ç–µ–Ω–∑–æ—Ä, –Ω–µ —á–∞—Å—Ç–∏–Ω–∞ –≥—Ä–∞—Ñ–∞, –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –≤ –º–æ–¥–µ–ª—å –æ–∫—Ä–µ–º–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º.

5.  **`timestamps` (Raw Time):**

      * Shape: `[num_nodes, 1]`
      * –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è: –î–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É `Time2Vec` –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –º–æ–¥–µ–ª—ñ.

6.  **`batch`:**

      * Shape: `[num_nodes]`
      * Index mapping –≤—É–∑–ª—ñ–≤ –¥–æ –≥—Ä–∞—Ñ—ñ–≤ —É –±–∞—Ç—á—ñ.

7.  **`y` (Targets):**

      * `y_class`: `[batch_size]` (Next Activity Index).
      * `y_time`: `[batch_size]` (Remaining Time Normalized).

<!-- end list -->

```
```
